name: ì•½ê´€ ì—…ë°ì´íŠ¸

on:
  push:
    branches:
      - main  # main ë¸Œëœì¹˜ì— í‘¸ì‹œí•  ë•Œ íŠ¸ë¦¬ê±°

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Commit changes
        run: |
          git config --local user.name "github-actions"
          git config --local user.email "github-actions@github.com"

          UPDATED=false
          UPDATED_FILES=""

          for FOLDER in allowPrivacy privacyTerm serviceTerm; do   # 3ê°œ ì•½ê´€ í´ë” ëª¨ë‘ ìˆœíšŒ
            latest_md=$(ls "$FOLDER"/*.md | sort -V | tail -n 1)
            target_md="$FOLDER.md"

            echo "ğŸ“ Updating $target_md with latest: $latest_md"
            cat "$latest_md" > "$target_md"

            if ! git diff --quiet "$target_md"; then              # íŒŒì¼ ë‚´ìš©ì´ ì‹¤ì œë¡œ ë°”ë€ ê²½ìš°ì—ë§Œ add
              git add "$target_md"
              UPDATED=true
              UPDATED_FILES="$UPDATED_FILES $target_md"
            fi
          done

          if [ "$UPDATED" = true ]; then
            COMMIT_MSG="Update ì•½ê´€ íŒŒì¼:$(echo $UPDATED_FILES | tr ' ' ', ' | sed 's/^, //')"   # tr ' ' ', 'ì€ ê³µë°±ì„ ì‰¼í‘œë¡œ ë°”ê¿”ì¤Œ
            git commit -m "$COMMIT_MSG"
            git push origin main
          else
            echo "âœ… No changes to commit."
          fi
